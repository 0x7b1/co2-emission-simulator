(this["webpackJsonpweb-app"]=this["webpackJsonpweb-app"]||[]).push([[0],{185:function(e,t){},248:function(e,t,a){e.exports=a(266)},259:function(e,t){},266:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),i=a(208),l=a.n(i),o=a(221),c=a(45),s=a(180),u=a.n(s),m=a(209),h=a(89),g=a(107),p=a(108),f=a(114),d=a(109),v=a(116),b=a(218),y=a(305),E=a(307),O=a(272),w=a(196),T=a(303),j=a(297),k=a(310),S=a(294),C=a(90),D=a(38),P=a(66),x=a(311),V=a(47),L=a(308),R=a(10),A=a(220),M=a(56),H=a(219),F=a(119),I=a(312),z=a(211),N=a(137),J=a.n(N),U=a(309),W=a(300),_=a(302),$=a(217),B=a(186),G=a(306),Y=a(313);function X(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function K(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?X(a,!0).forEach((function(t){Object(h.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):X(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Z,q=function(e){var t=e.value,a=e.min,r=e.max,i=e.step,l=e.onChange,o=e.formatTimeLabelThumb,s=e.formatTimeLabelTick,u=Object(D.b)(),m=Object(c.a)(u,2),h=m[0],g=m[1];return n.createElement(Y.a,{value:t,min:a,max:r,step:i,onChange:l,overrides:{ThumbValue:function(e){var t=e.$value,a=e.$thumbIndex;return n.createElement("div",{className:h(K({position:"absolute",top:"-".concat(g.sizing.scale1000),backgroundColor:"transparent"},g.typography.font100))},o(t[a]))},TickBar:function(e){var t=e.$min,a=e.$max;return n.createElement("div",{className:h(K({display:"flex",justifyContent:"space-between",alignItems:"center",paddingRight:g.sizing.scale600,paddingLeft:g.sizing.scale600,paddingBottom:g.sizing.scale400},g.typography.font100))},n.createElement("div",null,s(t)),n.createElement("div",null,s(a)))}}})},Q=Object(D.a)("div",{position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",bottom:"20px",right:"20px",zIndex:1,width:"240px"}),ee=function(e){function t(){return Object(g.a)(this,t),Object(f.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(p.a)(t,[{key:"renderCO2LinearGauge",value:function(){var e=this.props.co2ColorRange;return r.a.createElement("svg",{style:{width:"100%",height:"30px"}},r.a.createElement("g",{transform:"translate(13, 0)"},r.a.createElement("linearGradient",{id:"lineargradient",x1:"0",y1:"0",x2:"100%",y2:"0"},e.map((function(e,t){var a=Object(c.a)(e,3),n=a[0],i=a[1],l=a[2];return r.a.createElement("stop",{key:t,offset:t/10,stopColor:"rgb(".concat(n,", ").concat(i,", ").concat(l,")")})}))),r.a.createElement("rect",{width:"166",height:"10",style:{fill:'url("#lineargradient")'}}),r.a.createElement("g",{transform:"translate(0, 10)",style:{fill:"none",fontFamily:"sans-serif",textAnchor:"middle",fontSize:10}},r.a.createElement("g",{transform:"translate(0.5,0)"},r.a.createElement("line",{stroke:"currentColor",y2:"5"}),r.a.createElement("text",{fill:"currentColor",y:"8",dy:"0.71em"},"0")),r.a.createElement("g",{transform:"translate(83.5,0)"},r.a.createElement("line",{stroke:"currentColor",y2:"5"}),r.a.createElement("text",{fill:"currentColor",y:"8",dy:"0.71em"},"2100")),r.a.createElement("g",{transform:"translate(165.5,0)"},r.a.createElement("line",{stroke:"currentColor",y2:"5"}),r.a.createElement("text",{fill:"currentColor",y:"8",dy:"0.71em"},"5000")))))}},{key:"render",value:function(){return r.a.createElement(Q,null,r.a.createElement(S.a,null,r.a.createElement(C.b,null,r.a.createElement(P.d,{style:{textAlign:"center"}},"CO2 intensity (mg)"),this.renderCO2LinearGauge())))}}]),t}(n.PureComponent),te=a(295),ae=a(296),ne="https://0x7b1.github.io/co2-emission-simulator/data";console.log("->",Object({NODE_ENV:"production",PUBLIC_URL:""}));var re={SIMPLE:"SIMPLE",MONACO:"MONACO",TARTU:"TARTU"},ie={scenarios:(Z={},Object(h.a)(Z,re.SIMPLE,{urlData:"".concat(ne,"/simple.json"),initialPosition:{latitude:58.30079260885314,longitude:26.60045353923848}}),Object(h.a)(Z,re.TARTU,{urlData:"".concat(ne,"/tartu.json"),initialPosition:{latitude:58.38121869628752,longitude:26.73278172091453}}),Object(h.a)(Z,re.MONACO,{urlData:"".concat(ne,"/monaco.json"),initialPosition:{latitude:43.72876951717807,longitude:7.381480783579958}}),Z),config:{mapStyle:"mapbox://styles/mapbox/dark-v9",mapboxToken:"pk.eyJ1IjoiMHg3YjEiLCJhIjoiY2lwbHMxNnRvMDJkZXU5bmozYjF1a3UyYSJ9.ec73WL0KE8xDc9JFrchXPg",urlWs:"ws://".concat("127.0.0.1",":8081/ws"),co2ColorRange:[[42,163,100],[162,206,86],[240,225,75],[222,191,68],[205,158,61],[188,124,53],[171,91,46],[143,61,35],[82,39,12],[56,29,2]]},TEST_CASES:re},le=ie.TEST_CASES,oe=Object(D.a)("div",{position:"absolute",display:"flex",justifyContent:"left",alignItems:"center",right:"20px",top:"20px"}),ce=function(e){function t(){return Object(g.a)(this,t),Object(f.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(p.a)(t,[{key:"renderCO2LinearGauge",value:function(){var e=this.props.co2ColorRange;return r.a.createElement("svg",{style:{width:"100%",height:"30px"}},r.a.createElement("g",{transform:"translate(13, 0)"},r.a.createElement("linearGradient",{id:"lineargradient",x1:"0",y1:"0",x2:"100%",y2:"0"},e.map((function(e,t){var a=Object(c.a)(e,3),n=a[0],i=a[1],l=a[2];return r.a.createElement("stop",{key:t,offset:t/10,stopColor:"rgb(".concat(n,", ").concat(i,", ").concat(l,")")})}))),r.a.createElement("rect",{width:"166",height:"10",style:{fill:'url("#lineargradient")'}}),r.a.createElement("g",{transform:"translate(0, 10)",style:{fill:"none",fontFamily:"sans-serif",textAnchor:"middle",fontSize:10}},r.a.createElement("g",{transform:"translate(0.5,0)"},r.a.createElement("line",{stroke:"currentColor",y2:"5"}),r.a.createElement("text",{fill:"currentColor",y:"8",dy:"0.71em"},"0")),r.a.createElement("g",{transform:"translate(83.5,0)"},r.a.createElement("line",{stroke:"currentColor",y2:"5"}),r.a.createElement("text",{fill:"currentColor",y:"8",dy:"0.71em"},"2100")),r.a.createElement("g",{transform:"translate(165.5,0)"},r.a.createElement("line",{stroke:"currentColor",y2:"5"}),r.a.createElement("text",{fill:"currentColor",y:"8",dy:"0.71em"},"5000")))))}},{key:"render",value:function(){var e=this.props,t=e.onSelectTestCase,a=e.selectedTestCase;return r.a.createElement(oe,null,r.a.createElement(S.a,null,r.a.createElement(C.b,null,r.a.createElement(P.d,null,"Select the test scenario"),r.a.createElement(te.a,{name:"horizontal",onChange:t,value:a},r.a.createElement(ae.a,{value:le.TARTU},le.TARTU),r.a.createElement(ae.a,{value:le.MONACO},le.MONACO)))))}}]),t}(n.PureComponent);function se(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ue(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?se(a,!0).forEach((function(t){Object(h.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):se(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var me=ie.scenarios,he=ie.TEST_CASES,ge=ie.config,pe=ge.urlWs,fe=ge.mapboxToken,de=ge.mapStyle,ve=ge.co2ColorRange,be=new H.a,ye=Object(D.a)("div",{position:"absolute",display:"flex",justifyContent:"left",alignItems:"center",left:"20px",bottom:"20px"}),Ee=(new Date).getTime(),Oe=function(e){function t(e){var a;Object(g.a)(this,t),(a=Object(f.a)(this,Object(d.a)(t).call(this,e))).getViewState=function(e){var t=me[e],a=t.initialPosition;t.urlData;return ue({},a,{zoom:15,pitch:0,bearing:0,transitionDuration:2e3,transitionInterpolator:new w.a})},a.updateVehicleStep=function(e,t,a){return e.update(a.get("veh_id"),Object(M.c)({path:[],timestamps:[]}),(function(e){return e.update("path",(function(e){return e.push(Object(M.a)([a.get("lng"),a.get("lat")]))})).update("timestamps",(function(e){return e.push(t)})).update("co2",(function(){return a.get("co2")}))}))},a.connectWS=function(){var e=new WebSocket(pe);e.onopen=function(){return a.setState({ws:e})},e.onmessage=function(e){var t=e.data,n=a.state,r=n.liveVehiclePaths,i=n.liveVehicleData,l=(new Date).getTime()-Ee,o=Object(M.c)(JSON.parse(t));a.setState({liveVehiclePaths:a.updateVehicleStep(r,l,o),liveVehicleData:i.push(o),lastTime:l})},e.onerror=function(t){return e.close()},e.onclose=function(e){return console.log("DISCONNECTED")}},a.fetchData=Object(m.a)(u.a.mark((function e(){var t,n,r,i,l,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.selectedTestCase,n=me[t].urlData,e.prev=2,e.next=5,Object(A.a)(n);case 5:if(i=e.sent,console.log("->",JSON.stringify(i)),!(l=Object(M.c)(i)).isEmpty()){e.next=10;break}throw new Error("There is no data yet!");case 10:o=[new Date(l.first().get("time")).getTime(),new Date(l.last().get("time")).getTime()],a.setState(ue({histVehicleData:l,timeRange:o},(r=a).processHistoryData.apply(r,[l].concat(o)))),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])}))),a.filterDataRange=function(e){var t=Object(c.a)(e.value,2),n=t[0],r=t[1],i=a.state.histVehicleData,l=a.processHistoryData(i,n,r);a.setState(ue({},l))},a.onSelectTestCase=function(e){var t=e.target.value,n=a.getViewState(t);a.setState({selectedTestCase:t,viewState:n})},a.onViewStateChange=function(e){var t=e.viewState;a.setState({viewState:t})};var n=[1/0,-1/0];return a.state={viewState:a.getViewState(he.TARTU),selectedTestCase:he.TARTU,ws:null,liveVehiclePaths:Object(M.b)(),liveVehicleData:Object(M.a)(),histVehiclePaths:Object(M.b)(),histVehicleData:Object(M.a)(),histVehicleDataFiltered:Object(M.a)(),lastTime:0,timeRange:n,filterValue:n,isLiveMode:!1,showTrips:!0,showTrails:!1,showVehicles:!0,showEmissionsHist:!1,showEmissionsLive:!1},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){document.title="CO2 Emission Visualizer",this.fetchData(),this.connectWS()}},{key:"processHistoryData",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,r=Object(M.b)(),i=Object(M.a)();return e.forEach((function(e){var l=new Date(e.get("time")).getTime();l>=a&&l<=n&&(r=t.updateVehicleStep(r,l,e),i=i.push(e))})),{filterValue:[a,n],histVehiclePaths:r,histVehicleDataFiltered:i}}},{key:"getLiveLayers",value:function(){var e=this.state,t=e.liveVehiclePaths,a=e.liveVehicleData,n=e.lastTime,r=e.showTrails,i=e.showEmissionsLive,l=e.showVehicles;return[r&&new j.a({id:"trips-layer",data:t,getPath:function(e){return Object(c.a)(e,2)[1].get("path").toJS()},getTimestamps:function(e){return Object(c.a)(e,2)[1].get("timestamps").toArray()},getColor:[255,140,0],opacity:.9,rounded:!0,trailLength:3e4,widthMinPixels:5,currentTime:n}),l&&new E.a({id:"vehicles-layer",data:t,getPosition:function(e){var t=Object(c.a)(e,2);t[0];return t[1].get("path").last().toArray()},getFillColor:function(e){return[255,140,0]},getRadius:function(e){return 2},pickable:!0,opacity:.8,filled:!0,radiusMinPixels:6,radiusMaxPixels:10}),i&&new T.a({id:"live-heatmap-layer",data:a,getPosition:function(e){return[e.get("lng"),e.get("lat")]},getWeight:function(e){return e.get("co2")},colorRange:ve})]}},{key:"getHistLayers",value:function(){var e=this.state,t=e.showTrips,a=e.showEmissionsHist,n=e.histVehiclePaths,r=e.histVehicleDataFiltered;return[t&&new O.a({id:"path-layer",data:n,pickable:!0,getPath:function(e){return Object(c.a)(e,2)[1].get("path").toJS()},getWidth:function(e){var t,a,n=Object(c.a)(e,2)[1];return(n.get("path").size-(t=0))*(7-(a=2))/(500-t)+a},getColor:function(){return[255,140,0]},opacity:.5}),a&&new T.a({id:"historical-heatmap-layer",data:r,getPosition:function(e){return[e.get("lng"),e.get("lat")]},getWeight:function(e){return e.get("co2")},colorRange:ve})]}},{key:"formatTimeLabel",value:function(e,t){return J()(e).format(t)}},{key:"renderResolutionFilter",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r.a.createElement(L.a,{closeable:!1,variant:R.b.outlined,onClick:function(){var e,n=t.state,r=Object(c.a)(n.filterValue,1)[0],i=Object(c.a)(n.timeRange,2),l=i[0],o=i[1];if(a){var s=r+1e3*a;s>o&&(s=o),e=[r,s]}else e=[l,o];t.filterDataRange({value:e})}},e)}},{key:"renderHistoryOptions",value:function(){var e=this,t=this.state,a=t.showTrips,i=t.showEmissionsHist,l=t.timeRange,o=t.filterValue;return t.histVehicleData.isEmpty()?r.a.createElement(G.a,null):r.a.createElement(n.Fragment,null,r.a.createElement(k.a,null,r.a.createElement(x.a,{checkmarkType:V.b.toggle,checked:a,onChange:function(t){var a=t.target.checked;return e.setState({showTrips:a})},labelPlacement:V.a.right},"Show Traveled Paths")),r.a.createElement(k.a,null,r.a.createElement(x.a,{checkmarkType:V.b.toggle,checked:i,onChange:function(t){var a=t.target.checked;return e.setState({showEmissionsHist:a})},labelPlacement:V.a.right},"Show Emissions")),r.a.createElement(k.a,{label:"Date filter"},r.a.createElement(q,{value:o,min:l[0],max:l[1],step:6e4,formatTimeLabelThumb:function(t){return e.formatTimeLabel(t,"(DD/MM) HH:mm:ss")},formatTimeLabelTick:function(t){return e.formatTimeLabel(t,"DD/MM")},onChange:this.filterDataRange})),r.a.createElement(k.a,{label:"Time resolution"},r.a.createElement("div",null,this.renderResolutionFilter("5s",5),this.renderResolutionFilter("30s",30),this.renderResolutionFilter("1m",60),this.renderResolutionFilter("10m",600),this.renderResolutionFilter("30m",1800),this.renderResolutionFilter("1h",3600),this.renderResolutionFilter("All"))))}},{key:"renderLiveOptions",value:function(){var e=this,t=this.state,a=t.showTrails,i=t.showVehicles,l=t.showEmissionsLive;return r.a.createElement(n.Fragment,null,r.a.createElement(k.a,null,r.a.createElement(x.a,{checkmarkType:V.b.toggle,labelPlacement:V.a.right,checked:i,onChange:function(t){var a=t.target.checked;return e.setState({showVehicles:a})}},"Show Vehicles")),r.a.createElement(k.a,null,r.a.createElement(x.a,{checkmarkType:V.b.toggle,labelPlacement:V.a.right,checked:a,onChange:function(t){var a=t.target.checked;return e.setState({showTrails:a})}},"Show Trails")),r.a.createElement(k.a,null,r.a.createElement(x.a,{checkmarkType:V.b.toggle,checked:l,onChange:function(t){var a=t.target.checked;return e.setState({showEmissionsLive:a})},labelPlacement:V.a.right},"Show Emissions")))}},{key:"renderStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r.a.createElement(U.a,{sublist_:!0},e.map((function(e,t){var a=e.value,n=e.description;return r.a.createElement(W.a,{key:t,description:a},n)})))}},{key:"getRecorderTime",value:function(e,t){return J.a.utc(J()(t).diff(J()(e))).format("HH:mm:ss")}},{key:"getCO2Level",value:function(e,t){return 0}},{key:"renderStatsHist",value:function(){var e=this.state,t=e.timeRange,a=e.histVehiclePaths;return e.histVehicleData.isEmpty()?null:this.renderStats([{description:"Vehicles",value:a.size},{description:"Recorded Time",value:this.getRecorderTime.apply(this,Object(o.a)(t))}])}},{key:"renderStatsLive",value:function(){var e=this.state,t=e.liveVehiclePaths,a=e.lastTime;return this.renderStats([{description:"Vehicles",value:t.size},{description:"Recorded Time",value:this.getRecorderTime(Ee,a+Ee)}])}},{key:"render",value:function(){var e=this,t=this.state,a=t.isLiveMode,n=t.viewState,i=t.selectedTestCase,l=a?this.getLiveLayers():this.getHistLayers();return r.a.createElement(F.a,{value:be},r.a.createElement(I.a,{theme:z.LightTheme},r.a.createElement(y.a,{layers:l,initialViewState:n,controller:!0,pickingRadius:5,onViewStateChange:this.onViewStateChange},r.a.createElement(b.a,{reuseMaps:!0,mapStyle:de,preventStyleDiffing:!0,mapboxApiAccessToken:fe}),this._renderTooltip),r.a.createElement(ce,{selectedTestCase:i,onSelectTestCase:this.onSelectTestCase}),r.a.createElement(ye,null,r.a.createElement(S.a,null,r.a.createElement(C.b,null,r.a.createElement(_.a,{style_:{borderBottom:0}},r.a.createElement($.b,{$align:B.a.left},r.a.createElement($.a,{style:{paddingLeft:0}},r.a.createElement(P.a,null,"CO2 Emissions"))),r.a.createElement($.b,{$align:B.a.center}),r.a.createElement($.b,{$align:B.a.right},r.a.createElement($.a,null,r.a.createElement(x.a,{checkmarkType:V.b.toggle,isError:!0,checked:a,onChange:function(t){var a=t.target.checked;return e.setState({isLiveMode:a})},labelPlacement:V.a.left},"Live")))),a?this.renderStatsLive():this.renderStatsHist()),r.a.createElement(C.a,null,a?this.renderLiveOptions():this.renderHistoryOptions()))),r.a.createElement(ee,{co2ColorRange:ve})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(Oe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[248,1,2]]]);
//# sourceMappingURL=main.80b80f5d.chunk.js.map